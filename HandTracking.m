A =    [0.           53.          900.            1.        ;
    0.          107.          900.            1.        ;
  -36.88874817   44.          900.            1.        ;
  -36.8694191    26.13150406  897.82824707    1.        ;
  -36.85397339   11.85400772  895.95397949    1.        ;
  -36.83452606   -6.12519264  896.81884766    1.        ;
  -10.31876945   44.          900.            1.        ;
  -12.09298611    8.0739975   901.47467041    1.        ;
  -12.97572422   -9.80051994  899.54534912    1.        ;
  -13.85538483  -27.61271858  897.10571289    1.        ;
   11.66777992   44.          900.            1.        ;
    8.40291977    3.63314438  899.67163086    1.        ;
    6.59175014  -18.7602272   898.44421387    1.        ;
    5.07423687  -37.52281952  900.13897705    1.        ;
   36.43820953   44.          900.            1.        ;
   35.07268906   12.52993774  900.14294434    1.        ;
   34.29606628   -5.36823273  898.39587402    1.        ;
   33.53224564  -22.97138405  894.7154541     1.        ;
   24.09506607  108.5045166   897.87017822    1.        ;
   48.19013214   96.50902557  895.74041748    1.        ;
   77.89021301   78.11253357  887.05285645    1.        ;
   96.23149109   66.46498871  881.20629883    1.]        ;

for i = 1:size(A,1)
    h = plot3(A(i,1),A(i,2), A(i,3),'kx');
    set(h,'linewidth',1.5)
    hold on
    view(2)
    xlabel('x')
    ylabel('y')
    title('Hand coordinates')
    grid on
end

%  % handCentreHandTracking = [0, 53, 900]; %x
%  x = [0, 53, 900];
%  x = [x 1];
%  %b
%  % handCentreKinect = ([270.386 1.317779 285.0307]+ [270.4028 1.333887 285.046] + [270.3837 1.387721 285.0504] + [270.3884 1.33675 285.0423] + [270.401 1.336122 285.0438] + [270.3823 1.386446 285.0493])./6;
%  b = ([270.386 1.317779 285.0307]+ [270.4028 1.333887 285.046] + [270.3837 1.387721 285.0504] + [270.3884 1.33675 285.0423] + [270.401 1.336122 285.0438] + [270.3823 1.386446 285.0493])./6;
%  b = [b 1]; %  = [270.3907    1.3498  285.0438    1.0000]
% %  Ax = b
% %  Axx' = bx'
% %   A(xx')*inv(xx') = bx'*inv(xx')
% %   
% %   x'A' = b'
% %   x*x'A' = x*b'
% %   inv(x*x')(x*x')A' = inv(x*x')x*b'
% 
% 
%  %matrixA = inv(x*x')*x*b'
%  
%  %Rotation Matrix
%  % Rotate 180 around z axis of hand_tracking_system
%  R = [  cosd(180)    -sind(180)  0   0;
%         sind(180)   sind(180)    0   0;
%         0              0         1   0;
%         0               0        0   1];
%     
%  % Translation Matrix
%  T = [1 0 0 270.386;
%       0 1 0 1.3498-53;
%       0 0 1 285.0438-900;
%       0 0 0 1];
%   
%   
%   % Scaling Matrix
%   
%   
%   %b = T*R*x'


%% Using 3 vectors

x1 = [0, 53, 900,1];            % Hand centre (row 1)
x2 = [96.23, 66.46, 881.2, 1]; % Thumb tip (last row)
x3 = [5.074, -37.52, 900.1, 1]; % Hand tip (middle finger) (row 14)
x4 = [-36.83 -6.125 896.8 1];   % Hand tip (pinky) (row 6)
X = [x1' x2' x3' x4'];

% b1 = [270.3907    1.3498  285.0438    1.0000]; % Hand centre
% b2 = [1 1  1    1 ];% Thumb tip
% b3 = [-1 1 -1   1 ];% Thumb tip
% b4 = [25 3 0 1];% Hand tip (pinky)


MecanimBLendedCHaracter = [270.27, 1.09, 284.79];

% B0
% b1 = [270.3835, 1.2534, 284.9372, 1];
% b2 = [270.3089, 1.3068, 285.0385, 1] ;
% b3 = [270.4730, 1.2900, 285.1955, 1];
% b4 = [270.38880, 1.3000, 285.2000, 1];
% B = [b1' b2' b3' b4'];

% AX =B;
% A = Binv(X)


%% Revised B

% B1
%Cube positions
% b1 = [275.483 1.1529 275.4864 1];
% b3 = [275.4453 1.222 275.553 1];
% b2 = [275.3841 1.1537 275.436 1];
% b4 = [275.494 1.1804 275.5487 1];

% B2
% b1 = [275.4802 1.1552 275.5475 1]; % Hand centre (row 1)
% b3 = [275.4112 1.1468 275.5525 1]; % Thumb tip (last row)
% b2 = [275.476 1.2218 275.5525 1]; % Hand tip (middle finger) (row 14)
% b4 = [275.5036 1.204 275.5525 1]; % Hand tip (pinky) (row 6)

% B3
b1 = [275.3907 1.1321 275.5441 1]; % Hand centre (row 1)
b2 = [275.325 1.122 275.5428 1]; % Thumb tip (last row)
b3 = [275.385 1.2131 275.5532 1]; % Hand tip (middle finger) (row 14)
b4 = [275.4349 1.1837 275.55 1]; % Hand tip (pinky) (row 6)

B = [b1' b2' b3' b4'];

%Transform positions
% b2 = [-0.031371 2.980232 0 1] ;
% b3 = [-0.038891 5.960464 -3.026798 1];
% b4 = [-0.029924 0 0 1];   % Hand tip (pinky) (row 6)

matrix_A = B*inv(X);


% matrix_A =
% 
%     0.0013   -0.0009   -0.0000  270.4534
%    -0.0006   -0.0004    0.0000    1.2637
%    -0.0023   -0.0030    0.0000  285.0540
%     0.0000    0.0000    0.0000    1.0000

% New Matrix
% matrix_A =
% 
%    -0.0009    0.0004   -0.0000  275.4656
%     0.0004   -0.0007   -0.0000    1.1956
%    -0.0005   -0.0008    0.0000  275.5262
%     0.0000    0.0000    0.0000    1.0000

% 
% matrix_A =
% 
%    -0.0017    0.0007    0.0000  275.4278
%    -0.0014    0.0000    0.0000    1.1321
%    -0.0000   -0.0001    0.0000  275.5494
%     0.0000    0.0000    0.0000    1.0000


figure;
transformed_co = A';
for i = 1:size(A,1)
    %transformed_co(:,i) = matrix_A*transformed_co(:,i);
    transformed_co_2(:,i) = matrix_A*transformed_co(:,i);
end

transformed_co_3 = transformed_co_2';
for i = 1:size(A,1)
    h = plot3(transformed_co_3(i,1),transformed_co_3(i,2), transformed_co_3(i,3),'x-');
    set(h,'linewidth',1.5)
    hold on
    view(2)
    xlabel('x')
    ylabel('y')
    title('Hand coordinates')
    grid on
end